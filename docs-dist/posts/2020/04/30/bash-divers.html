<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Divers Shell | Doc Informatique</title>
    <meta name="description" content="Documentation Informatique de PM">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="preload" href="/assets/js/vendor.vue.fe60f49a.js" as="script"><link rel="preload" href="/assets/css/0.styles.79e55998.css" as="style"><link rel="preload" href="/assets/js/vendor.commons.79e55998.js" as="script"><link rel="preload" href="/assets/css/styles.5a166caf.css" as="style"><link rel="preload" href="/assets/js/app.5a166caf.js" as="script"><link rel="preload" href="/assets/css/5.styles.49f7c171.css" as="style"><link rel="preload" href="/assets/js/5.49f7c171.js" as="script"><link rel="preload" href="/assets/js/22.9d19bcde.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.61d85fa1.css"><link rel="prefetch" href="/assets/css/4.styles.7f5a57d5.css"><link rel="prefetch" href="/assets/css/6.styles.a29e31ec.css"><link rel="prefetch" href="/assets/css/7.styles.11b4d3de.css"><link rel="prefetch" href="/assets/css/8.styles.9e8cf761.css"><link rel="prefetch" href="/assets/js/1.61d85fa1.js"><link rel="prefetch" href="/assets/js/10.6169a6e8.js"><link rel="prefetch" href="/assets/js/11.23e1a088.js"><link rel="prefetch" href="/assets/js/12.83c17428.js"><link rel="prefetch" href="/assets/js/13.7e1b3626.js"><link rel="prefetch" href="/assets/js/14.6dddce4d.js"><link rel="prefetch" href="/assets/js/15.758e396d.js"><link rel="prefetch" href="/assets/js/16.832b7a97.js"><link rel="prefetch" href="/assets/js/17.3f006a36.js"><link rel="prefetch" href="/assets/js/18.6d908d3f.js"><link rel="prefetch" href="/assets/js/19.6cdabfcc.js"><link rel="prefetch" href="/assets/js/20.6e98f375.js"><link rel="prefetch" href="/assets/js/21.404d980e.js"><link rel="prefetch" href="/assets/js/23.4fc7977d.js"><link rel="prefetch" href="/assets/js/24.7402f289.js"><link rel="prefetch" href="/assets/js/25.d2d26dc9.js"><link rel="prefetch" href="/assets/js/26.a1e0e39b.js"><link rel="prefetch" href="/assets/js/27.2840e3de.js"><link rel="prefetch" href="/assets/js/4.7f5a57d5.js"><link rel="prefetch" href="/assets/js/6.a29e31ec.js"><link rel="prefetch" href="/assets/js/7.11b4d3de.js"><link rel="prefetch" href="/assets/js/8.9e8cf761.js"><link rel="prefetch" href="/assets/js/9.3a979c0d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.79e55998.css"><link rel="stylesheet" href="/assets/css/styles.5a166caf.css"><link rel="stylesheet" href="/assets/css/5.styles.49f7c171.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" data-v-83e90190><div data-v-dac9239e data-v-83e90190><nav class="navbar" data-v-dac9239e><div class="container" data-v-dac9239e><a href="/" class="router-link-active" data-v-dac9239e><span class="navbar-site-name" data-v-dac9239e>
          Doc Informatique
        </span></a> <div class="navbar-toggler" data-v-dac9239e><svg class="icon" style="font-size:1.2em;" data-v-dac9239e data-v-dac9239e><title data-v-dac9239e data-v-dac9239e>menu</title><use xlink:href="#icon-menu" data-v-dac9239e data-v-dac9239e></use></svg></div> <div class="navbar-links" data-v-dac9239e><a href="/" class="navbar-link" data-v-dac9239e>
            Accueil
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-dac9239e>
            Notes
          </a><a href="/custom-pages/" class="navbar-link" data-v-dac9239e>
            Pages
          </a> <div class="el-dropdown el-dropdown" data-v-dac9239e><span class="el-dropdown-link" data-v-dac9239e><i class="el-icon-setting" data-v-dac9239e></i></span> <ul class="el-dropdown-menu el-popper" style="display:none;" data-v-dac9239e><li tabindex="-1" class="el-dropdown-menu__item" data-v-dac9239e><!---->Action 1</li> <li tabindex="-1" class="el-dropdown-menu__item" data-v-dac9239e><!---->Action 2</li></ul></div></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-dac9239e></div></div> <div class="banner" data-v-66d98992 data-v-83e90190 data-v-83e90190><div class="container" data-v-66d98992><div class="center" data-v-66d98992><h1 data-v-66d98992 data-v-83e90190>
          Divers Shell
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-5c57807a data-v-5c57807a><aside class="aside" data-v-5c57807a><div class="info-card main-div" data-v-e46644d8 data-v-5c57807a><div class="info-card-header" data-v-e46644d8><img src="https://www.meteorlxy.cn/assets/img/avatar.jpg" alt="meteorlxy" class="info-avatar" data-v-e46644d8></div> <div class="info-card-body" data-v-e46644d8><section class="info-nickname" data-v-e46644d8>
        meteorlxy
      </section> <section class="info-desc" data-v-e46644d8>Happy Coding<br/>Happy Life</section></div></div> <!----></aside> <main class="main" data-v-5c57807a><div class="post" data-v-5c57807a data-v-5c57807a><article class="main-div"><div class="post-content content content__default"><h3 id="boucler-sur-les-champs-de-ligne-en-awk"><a href="#boucler-sur-les-champs-de-ligne-en-awk" class="header-anchor">#</a> <a href="http://www.ixany.org/2014/11/01/Boucler-sur-les-champs-de-ligne-en-awk.html" target="_blank" rel="noopener noreferrer">Boucler sur les champs de ligne en awk<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Ã‰tiquettes : shel, awk. Ã‰crit le 01/11/2014.</p> <p>SousÂ <em>awk</em>, si on veut effectuer une boucle sur un nombre variable de champs dâ€™une ligne, il suffit de se rappeler que le nombre de champs dâ€™une ligne est conservÃ© dans la variableÂ <code>NF</code>, et que la valeur dâ€™un champ peut Ãªtre lu en prÃ©fixant une variable numÃ©rique parÂ <code>$</code>Â (donc, si la variableÂ <code>i</code>Â vautÂ <em>3</em>, alorsÂ <code>$i</code>Â est Ã©quivalent Ã Â <code>$3</code>Â et donne la valeur du troisiÃ¨me champ de la ligne en cours).</p> <p>Voici par exemple un fichier contenant une liste dâ€™utilisateurs dont le nom est donnÃ© dans le premier champ de chaque ligne, suivi dâ€™un nombre variable dâ€™entiers (dÃ©signant par exemple des numÃ©ro de loto quâ€™il a reÃ§u)Â :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> loto.txt
<span class="token comment"># PrÃ©nom liste_des_numÃ©ros</span>
Philip <span class="token number">2</span> <span class="token number">65</span> <span class="token number">12</span> <span class="token number">96</span>
Turanga <span class="token number">55</span> <span class="token number">34</span> <span class="token number">82</span>
Hubert <span class="token number">23</span>
Amy <span class="token number">44</span> <span class="token number">12</span> <span class="token number">9</span> <span class="token number">24</span>
Hermes <span class="token number">32</span> <span class="token number">99</span> <span class="token number">8</span>
</code></pre></div><p>Le petit programme awk appelÃ© dâ€™un shell ci-dessous parcourt le fichierÂ <em>loto.txt</em>Â et affiche une ligne par numÃ©ro attribuÃ© Ã  une personne (les lignes commenÃ§ant parÂ <code>#</code>Â sont ignorÃ©es)Â :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">awk</span> <span class="token string">'
  /^#/ { next }
  {
      for (i=2; i&lt;=NF; i++) {
          printf &quot;%s a reÃ§u le numÃ©ro %d<span class="token entity" title="\n">\n</span>&quot;, <span class="token variable">$1</span>, <span class="token variable">$i</span>
      }
  }
  '</span> loto.txt
Philip a reÃ§u le numÃ©ro <span class="token number">65</span>
Philip a reÃ§u le numÃ©ro <span class="token number">12</span>
Philip a reÃ§u le numÃ©ro <span class="token number">96</span>
Turanga a reÃ§u le numÃ©ro <span class="token number">55</span>
Turanga a reÃ§u le numÃ©ro <span class="token number">34</span>
Turanga a reÃ§u le numÃ©ro <span class="token number">82</span>
Hubert a reÃ§u le numÃ©ro <span class="token number">23</span>
<span class="token punctuation">..</span>.
</code></pre></div><h3 id="parcourir-les-parametres-positionnels-d-un-script-shell-dans-les-deux-sens"><a href="#parcourir-les-parametres-positionnels-d-un-script-shell-dans-les-deux-sens" class="header-anchor">#</a> <a href="http://www.ixany.org/2014/10/19/Parcourir-les-parametres-d-un-script-shell.html" target="_blank" rel="noopener noreferrer">Parcourir les paramÃ¨tres positionnels d'un script shell... dans les deux sens<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Ã‰tiquettes : shell, bash. Ã‰crit le 19/10/2014.</p> <p>Pour traiter un Ã  un les paramÃ¨tres positionnels passÃ©s Ã  un script ou une fonction shell, on utilise simplement une boucleÂ <code>for</code>Â de ce genreÂ :</p> <div class="language- extra-class"><pre class="language-text"><code>for arg
do
    # faire quelque chose avec $arg
    echo &quot;argument $arg&quot;;
done
</code></pre></div><p>UtilisÃ© sans clause Â«Â <code>in ...</code>Â Â»,Â <code>for</code>Â effectue une boucle sur tous les paramÃ¨tres positionnels, ce qui revient donc au mÃªme que dâ€™utiliser Â«Â <code>for arg in $@</code>Â Â».</p> <p>Mais parcourir la liste de ces paramÃ¨tresÂ <em>Ã  lâ€™envers</em>Â nâ€™est pas beaucoup plus difficile, grÃ¢ce Ã  une petite astuceÂ :</p> <div class="language- extra-class"><pre class="language-text"><code>for i in $(seq $# -1 1)
do
    arg=${!i}
    # faire quelque chose avec $arg
    echo &quot;argument $arg&quot;;
done
</code></pre></div><p><code>for</code>Â boucle ici sur les numÃ©ros de paramÃ¨tres quâ€™on veut traiter, du dernier paramÃ¨tre, donnÃ© par la variableÂ <code>$#</code>, au premier, numÃ©rotÃ©Â <code>1</code>Â (<code>$0</code>Â nâ€™est pas un paramÃ¨tre, mais le nom du script).</p> <blockquote><p><em>Note</em>Â : on a recours Ã  la commandeÂ <code>seq</code>Â car le gÃ©nÃ©rateur de sÃ©rie interne Ã  bash (du typeÂ <code>{10..1}</code>) utilise les accolades qui sont Ã©valuÃ©esÂ <em>avant</em>Â le remplacement des variables. On ne peut doncÂ <strong>pas</strong>Â Ã©crire quelque chose comme Â«Â <code>{$#..1}</code>Â Â».</p></blockquote> <p>Ensuite, pour lire la valeur du paramÃ¨tre positionnel (contenue dansÂ <code>$4</code>,Â <code>$3</code>, â€¦), on introduit un niveau dâ€™imbrication de variable grÃ¢ce au point dâ€™exclamationÂ : il indique quâ€™on veut lire la valeur dâ€™une variable dont le nom est contenu dans une autre variable.</p> <p>Ainsi, siÂ <code>$i</code>Â contientÂ <code>3</code>,Â <code>${!i}</code>Â sera remplacÃ© par la valeur de la variableÂ <code>$3</code>, donc le troisiÃ¨me argument positionnel du script ou de la fonction. Et Ã§a tombe plutÃ´t bien, câ€™est ce quâ€™on voulaitÂ !</p> <blockquote><p><em>Corolaire</em>Â :Â <em>le dernier paramÃ¨tre</em>Â dâ€™un script peut donc Ãªtre lu directement grÃ¢ce Ã  lâ€™expression Â«Â <code>${!#}</code>Â Â» dont lâ€™explication ne peut plus vous Ã©chapperÂ ğŸ˜ƒ</p></blockquote> <p>Et si vous voulez boucler sur un sous-ensemble des paramÃ¨tres positionnels, voir mon astuce Â«Â <a href="http://www.ixany.org/2014/10/16/Acceder-aux-arguments-du-script-shell.html" target="_blank" rel="noopener noreferrer">AccÃ©der facilement aux arguments dâ€™un script shell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>Â Â».</p> <h3 id="acceder-facilement-aux-arguments-d-un-script-shell"><a href="#acceder-facilement-aux-arguments-d-un-script-shell" class="header-anchor">#</a> <a href="http://www.ixany.org/2014/10/16/Acceder-aux-arguments-du-script-shell.html" target="_blank" rel="noopener noreferrer">AccÃ©der facilement aux arguments d'un script shell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Ã‰tiquettes : shell, bash. Ã‰crit le 16/10/2014.</p> <p>Dans un script ou une fonction shell, on a souvent besoin dâ€™accÃ©der aux arguments qui lui ont Ã©tÃ© passÃ©s. Câ€™est simple quand on connaÃ®t prÃ©cisÃ©ment son indice dans la liste des arguments, grÃ¢ce aux paramÃ¨tres positionnelsÂ <code>$1</code>,Â <code>$2</code>, â€¦,Â <code>$n</code>.</p> <p>Mais il est Ã©galement possible dâ€™accÃ©der Ã  un paramÃ¨tre dont on connaÃ®t la position depuisÂ <em>la fin</em>Â de la liste des paramÃ¨tresÂ :</p> <div class="language- extra-class"><pre class="language-text"><code>$ function f() {
    echo &quot;mon avant-dernier paramÃ¨tre est '${@: -2:1}'&quot;
}
$ f un deux trois    
mon avant-dernier paramÃ¨tre est 'deux'
</code></pre></div><blockquote><p><em>Attention</em>Â : il ne faut pas oublier de placer une espace entre le deux-points et le tiret, pour Ã©viter que bash ne confonde avec Â«Â <code>:-</code>Â Â» qui reprÃ©sente lâ€™utilisation de valeur par dÃ©faut.</p></blockquote> <p>On peut Ã©galement rÃ©cupÃ©rer, par exemple, une liste de deux paramÃ¨tres avec quelque chose commeÂ <code>${@:2:2}</code>Â ouÂ <code>${@: -4:2}</code>, les cinq derniers avecÂ <code>${@: -5}</code>, ou encore le dernier argument avecÂ <code>${@: -1}</code>.</p> <p>Pour plus de dÃ©tails sur les expressions du typeÂ <code>${paramÃ¨tre:dÃ©but:longueur}</code>, voir ma documentation sur laÂ <a href="http://www.ixany.org/docs/Shell_Manipulation_chaines_et_tableaux_en_bash.html" target="_blank" rel="noopener noreferrer">manipulation des chaÃ®nes de caractÃ¨res et des tableaux en bash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="limiter-rsync-a-un-repertoire"><a href="#limiter-rsync-a-un-repertoire" class="header-anchor">#</a> <a href="http://www.ixany.org/2014/10/14/Limiter-rsync-a-un-repertoire.html" target="_blank" rel="noopener noreferrer">Limiter rsync Ã  un rÃ©pertoire<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Ã‰tiquettes : rsync, shell, GNU. Ã‰crit le 14/10/2014.</p> <p>Lors de la mise en place de synchronisations automatisÃ©es des donnÃ©es Ã  lâ€™aide deÂ <a href="http://manpages.debian.org/cgi-bin/man.cgi?query=rsync&amp;apropos=0&amp;sektion=0&amp;manpath=Debian+7.0+wheezy&amp;format=ascii&amp;locale=en" target="_blank" rel="noopener noreferrer">rsync<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, il est souvent souhaitable de limiter ses accÃ¨s Ã  un rÃ©pertoire particulier, parfois mÃªme en lecture seule.</p> <p>Câ€™est possible lors de lâ€™utilisation dâ€™un daemonÂ <em>rsyncd</em>, mais cette solution ne permet pas le chiffrement des donnÃ©es lors de leur transfert sur le rÃ©seau. Lâ€™utilisation deÂ <em>rsync sur ssh</em>Â rÃ©soud ce problÃ¨me, mais ne permet pas de bÃ©nÃ©ficier des fonctionnalitÃ©s deÂ <em>rsyncd</em>.</p> <p>Le script perl Â«Â <em>rrsync</em>Â Â» fourni avecÂ <em>rsync</em>Â permet heureusement de retrouver ces fonctionnalitÃ©s avec rsync sur ssh.</p> <p>Cette solution sâ€™appuie sur la possibilitÃ© quâ€™offreÂ <em>openssh</em>Â de forcer lâ€™exÃ©cution dâ€™un script lors de lâ€™utilisation dâ€™une clef ssh. Ce script ayant accÃ¨s Ã  la commande originale envoyÃ©e par le programeÂ <em>rsync</em>Â distant, il peut la contrÃ´ler avant de lâ€™exÃ©cuter ou non (voirÂ <a href="http://www.ixany.org/docs/OpenSSH_limiter_une_clef_ssh.html#command" target="_blank" rel="noopener noreferrer">ma documentation sur les options associÃ©es Ã  une clef ssh<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>).</p> <p>En pratique, il faut donc gÃ©nÃ©rer une clef ssh dÃ©diÃ©e Ã  ces synchronisations de donnÃ©es sur la machine qui initie le transfertÂ <em>rsync</em>Â (iciÂ <em>machine1</em>), et la copier sur la machine oÃ¹ se trouvent les donnÃ©es dâ€™origine (<em>machine2</em>)Â :</p> <div class="language- extra-class"><pre class="language-text"><code>machine1$ ssh-keygen -f ~/.ssh/id_sauvegardes
machine1$ ssh-copy-id -i ~/.ssh/id_sauvegardes monutilisateur@machine2
</code></pre></div><p>On configure ensuiteÂ <em>machine2</em>Â pour forcer lâ€™utilisation deÂ <em>rrsync</em>Â lors des connexions utilisant cette clef en modifiant la ligne ajoutÃ©e parÂ <em>ssh-copy-id</em>Â dans le fichierÂ <em>~/.ssh/config</em>, pour y prÃ©ciser lâ€™option Â«Â <em>command</em>Â Â» (sur la mÃªme ligne, juste avant le type de la clef)Â :</p> <div class="language- extra-class"><pre class="language-text"><code>machine2$ editor ~/.ssh/authorized_keys
...
command=&quot;rrsync -ro /srv/results&quot; ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAIEAmkHG1WCjC...
</code></pre></div><p><code>/srv/results</code>Â est ici le rÃ©pertoire contenant les donnÃ©es auxquellesÂ <em>machine1</em>Â aura accÃ¨s. Lâ€™optionÂ <code>-ro</code>Â est facultative et nâ€™autorisera que les accÃ¨s en lecture aux donnÃ©es (câ€™est Ã  dire les transfertsÂ <em>rsync</em>Â dans lesquelsÂ <em>machine2</em>Â est lâ€™expÃ©diteur, donc oÃ¹Â <em>rsync</em>Â y est invoquÃ©e Ã  distance avec lâ€™option interneÂ <code>--sender</code>).</p> <p>Le lancement du transfertÂ <em>rsync</em>Â se fait comme dâ€™habitude surÂ <em>machine1</em>, par exemple avec la commandeÂ :</p> <div class="language- extra-class"><pre class="language-text"><code>machine1$ rsync -e 'ssh -i ~/.ssh/id_sauvegardes' /srv/results/job0/ /srv/jobs/job0
</code></pre></div><p>Lâ€™optionÂ <code>-e</code>Â nâ€™est utile que pour fournir lâ€™optionÂ <code>-i</code>Â au clientÂ <em>openssh</em>Â indiquant la clef Ã  utiliser, mais cela peut aussi bien se faire Ã  lâ€™aide du fichierÂ <em>~/.ssh/config</em>.</p> <p>Sous Debian GNU/Linux, le script perlÂ <em>rrsync</em>Â est fourni avec le paquetÂ <em>rsync</em>, mais seulement Ã  titre dâ€™exemple. Vous devrez donc dâ€™abord lâ€™installer dans un rÃ©pertoire des commandes du systÃ¨me. Par exemple, siÂ <em>/usr/local/bin</em>Â est bien contenu dans la variableÂ <em>$PATH</em>Â :</p> <div class="language- extra-class"><pre class="language-text"><code>gzip -c /usr/share/doc/rsync/scripts/rrsync.gz &gt; /usr/local/bin/rrsync
chmod 755 /usr/local/bin/rrsync
</code></pre></div><p>Lisez les commentaires du scriptÂ <em>rrsync</em>Â pour plus dâ€™information sur son fonctionnement. Pour les dÃ©tails sur les options associÃ©es aux clef ssh dans le fichierÂ <em>~/.ssh/config</em>, voirÂ <a href="http://manpages.debian.org/cgi-bin/man.cgi?query=sshd&amp;apropos=0&amp;sektion=0&amp;manpath=Debian+7.0+wheezy&amp;format=ascii&amp;locale=en" target="_blank" rel="noopener noreferrer">la page de manuel de sshd(8)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, dans sa section Â«Â <em>AUTHORIZED_KEYS FILE FORMAT</em>Â Â», ouÂ <a href="http://www.ixany.org/docs/OpenSSH_limiter_une_clef_ssh.html" target="_blank" rel="noopener noreferrer">ma documentation sur les options associÃ©es Ã  une clef ssh<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="la-commande-gnu-date"><a href="#la-commande-gnu-date" class="header-anchor">#</a> <a href="http://www.ixany.org/2014/10/04/La-commande-gnu-date.html" target="_blank" rel="noopener noreferrer">La commande GNU date<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Ã‰tiquettes : shell, GNU. Ã‰crit le 04/10/2014.</p> <p>Vous connaissez probablement dÃ©jÃ  les nombreux formats de date et dâ€™heure selon lesquels la commandeÂ <a href="http://www.gnu.org/" target="_blank" rel="noopener noreferrer">GNU<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>Â date peut afficher ses informations.Â <a href="http://manpages.debian.org/cgi-bin/man.cgi?query=date&amp;apropos=0&amp;sektion=0&amp;manpath=Debian+7.0+wheezy&amp;format=html&amp;locale=fr" target="_blank" rel="noopener noreferrer">La page de manuel de date(1)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>Â nous renseigne sur ces nombreux formats, dÃ©signÃ©s de faÃ§on similaire Ã  ce que fait Â«Â printfÂ Â» (<a href="http://manpages.debian.org/cgi-bin/man.cgi?query=printf&amp;sektion=3&amp;apropos=0&amp;manpath=Debian+7.0+wheezy&amp;locale=fr" target="_blank" rel="noopener noreferrer">la fonction du langage C<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, ouÂ <a href="http://manpages.debian.org/cgi-bin/man.cgi?query=printf&amp;apropos=0&amp;sektion=0&amp;manpath=Debian+7.0+wheezy&amp;format=html&amp;locale=fr" target="_blank" rel="noopener noreferrer">la commande du shell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>), dans une chaÃ®ne de caractÃ¨res commenÃ§ant par Â«Â +Â Â». En voici un exempleÂ :</p> <div class="language- extra-class"><pre class="language-text"><code>$ date +&quot;Le %A %e %B %Y Ã  %R (le %j iÃ¨me jour de l'annÃ©e)&quot;.
Le samedi  4 octobre 2014 Ã  18:15 (le 277 iÃ¨me jour de l'annÃ©e).
</code></pre></div><p>Mais une fonctionnalitÃ© beaucoup moins connue deÂ <em>date</em>Â en fait une commande particuliÃ¨rement puissante. Elle nâ€™est pourtant Ã©voquÃ©e que trÃ¨s discrÃ¨tement dansÂ <a href="http://manpages.debian.org/cgi-bin/man.cgi?query=date&amp;apropos=0&amp;sektion=0&amp;manpath=Debian+7.0+wheezy&amp;format=html&amp;locale=fr" target="_blank" rel="noopener noreferrer">sa page de manuel<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, on peut donc facilement passer Ã  cÃ´tÃ©Â : il sâ€™agit de lâ€™option Â«Â -dÂ Â», et plus prÃ©cisÃ©ment la faÃ§on dont on peut dÃ©signer la date Ã  afficher.</p> <p>On peut prÃ©ciser cette date ou cette heure de faÃ§on absolue, comme Â«Â 1914-07-28 06:00Â Â» ou Â«Â 28 July 1914 17:00Â Â» (seuls les noms en anglais sont reconnus)Â :</p> <div class="language- extra-class"><pre class="language-text"><code>$ date -d '1914-07-28 06:00'
mardi 28 juillet 1914, 06:00:00 (UTC+0200)
$ date -d '28 July 1914 06:00:00'
mardi 28 juillet 1914, 06:00:00 (UTC+0200)
</code></pre></div><p>Mais ce qui est particuliÃ¨rement pratique, câ€™est de la dÃ©signer de faÃ§on relative Ã  lâ€™heure actuelle ou Ã  une date fournieÂ :</p> <div class="language- extra-class"><pre class="language-text"><code>$ date -d 'yesterday'
vendredi 3 octobre 2014, 18:15:37 (UTC+0200)
$ date -d '2 days ago'
jeudi 2 octobre 2014, 18:15:42 (UTC+0200)
$ date -d 'last monday'
lundi 29 septembre 2014, 00:00:00 (UTC+0200)
$ date -d '1918-11-11 - 4 years'
mercredi 11 novembre 1914, 00:00:00 (UTC+0200)
$ date -d '2000-01-01 - 1 day'
vendredi 31 dÃ©cembre 1999, 00:00:00 (UTC+0200)
</code></pre></div><p>Les formats dâ€™entrÃ©e de date sont documentÃ©s dans la pageÂ <em>info</em>Â de dateÂ : lancez la commandeÂ <em>info date</em>, et suivez le lien Â«Â <em>Date input formats::</em>Â Â» (placer le curseur dessus et tapez Â«Â EntrÃ©eÂ Â»). Cette page donne des liens vers tous les formats acceptÃ©s pour prÃ©ciser la date Ã  afficher; pour les informations sur les dates relatives, suivre le lien Â«Â <em>Relative items in date strings::</em>Â Â».</p> <p>Attention toutefois Ã  quelques subtilitÃ©sÂ : comme le prÃ©cise la documentation, le terme Â«Â last monthÂ Â» Ã©quivaut Ã  Â«Â - 30 daysÂ Â». Il faut donc prendre garde lorsquâ€™on lâ€™utilise le dernier jour du moisÂ :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>~$ <span class="token function">date</span> -d <span class="token string">&quot;2014-10-31 last month&quot;</span>
mercredi <span class="token number">1</span> octobre <span class="token number">2014</span>, 00:00:00 <span class="token punctuation">(</span>UTC+0200<span class="token punctuation">)</span>
</code></pre></div><p>Pour obtenir le nom du mois prÃ©cÃ©dent, il faut prÃ©ciser un jour du mois qui ne posera pas de problÃ¨meÂ :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">date</span> -d <span class="token string">&quot;2014-10-01 last month&quot;</span> +%B
septembre
</code></pre></div><p>En complÃ©ment, pour obtenir lâ€™heure dans un autre fuseau horaire, il suffit de changer la variable dâ€™environnementÂ <em>TZ</em>, soit pour tout le shell (via la commandeÂ <em>export TZ=â€¦</em>), soit uniquement pour une commande.</p> <p>Quelle heure est-il actuellement Ã  Hong-KongÂ :</p> <div class="language- extra-class"><pre class="language-text"><code>$ TZ=&quot;Asia/Hong_Kong&quot; date
dimanche 5 octobre 2014, 00:37:00 (UTC+0800)
</code></pre></div><p>Mieux encore, comme le montre la documentation de la commande, on peut prÃ©ciser le fuseau horaire de la date quâ€™on veut afficher, donc demander par exemple quelle heure il est Ã  Hong-Kong quand il est 18h40 Ã  Port-au-PrinceÂ :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token assign-left variable">TZ</span><span class="token operator">=</span><span class="token string">&quot;Asia/Hong_Kong&quot;</span> <span class="token function">date</span> -d <span class="token string">'TZ=&quot;America/Port-au-Prince&quot; 2014-10-04 18:45'</span>
dimanche <span class="token number">5</span> octobre <span class="token number">2014</span>, 06:45:00 <span class="token punctuation">(</span>UTC+0800<span class="token punctuation">)</span>
</code></pre></div><p>Ref: <a href="http://www.ixany.org/" target="_blank" rel="noopener noreferrer">Documentations informatiques<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p></div></article> <!----> <section class="post-meta main-div" data-v-e9f08734><section class="post-date clearfix" data-v-e9f08734><span class="create-date" data-v-e9f08734>
      CrÃ©Ã© le : 30/04/2020Â 
    </span> <span class="create-date" data-v-e9f08734>
      Ã  Kampot
    </span> <span class="update-date" data-v-e9f08734>
      ModifiÃ© le : 17/05/2020 Ã  14:17:44
    </span></section></section></div></main></div> <footer class="footer" data-v-2c67d6af><p class="footer-sns-links" data-v-2c67d6af><a href="https://github.com/meteorlxy" target="_blank" class="sns-link" data-v-2c67d6af><span title="GitHub: meteorlxy" class="sns-icon" data-v-2c67d6af data-v-2c67d6af><svg class="icon" style="font-size:25px;" data-v-2c67d6af data-v-2c67d6af><title data-v-2c67d6af data-v-2c67d6af>GitHub: meteorlxy</title><use xlink:href="#icon-github" data-v-2c67d6af data-v-2c67d6af></use></svg></span></a></p> <p class="footer-text" data-v-2c67d6af><span data-v-2c67d6af>Powered by </span> <a href="https://github.com/vuejs/vuepress" target="_blank" data-v-2c67d6af>
      VuePress
    </a> <span data-v-2c67d6af> | </span> <a href="https://github.com/meteorlxy/vuepress-theme-meteorlxy" target="_blank" data-v-2c67d6af>
        meteorlxy
      </a></p> <p class="footer-text" data-v-2c67d6af>Copyright PM and meteorlxy</p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/vendor.vue.fe60f49a.js" defer></script><script src="/assets/js/5.49f7c171.js" defer></script><script src="/assets/js/22.9d19bcde.js" defer></script><script src="/assets/js/vendor.commons.79e55998.js" defer></script><script src="/assets/js/app.5a166caf.js" defer></script>
  </body>
</html>
